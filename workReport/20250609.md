
wpglb-fms：develop/finance-2025.06.12
westernpost-wms：develop/finance-2025.06.12
westernpost-common：develop/finance-2025.06.12
wpglb-bms-pipeline-task：develop/finance-2025.06.12




(一)财务&渠道迭代
任务 1：【WMS-账单汇总】查询提速优化。因关联表查询仓库以及客户数据需要全表聚合扫描，查询慢原因
    a. 将查询账单汇总仓库和客户SQL单独拎出来查询。(时间范围一个月内查询耗时15秒优化至1.5秒)
任务 2：【WMS-账单汇总】全局支持中英文格式。
    a. 各费用页签部分中文表头支持中英文展示(15个表头字段)。
    b. 各费用页签部分中文数据列支持中英文展示(35个数据列)。
    c. 账单解析涉及字段兼容。转运-危险品标签费/物流补收-单据类型/退货物流-订单类型
任务 3：财务6月迭代二需求设计评审。
任务 4：【WMS-费用减免】导出、财务导出Excel首行添加金额合计列。
    a. Excel导出工具新增方法，支持指定表头首行自动汇总功能。
    b. 增值减免导出任务，迁移到common导出任务服务内，并支持首行自动汇总。
任务 5：【FMS-物流成本明细】新增“变更签约主体”功能及其他调整-开发设计。
任务 6：【WMS-头程账单开票管理】增加导出功能-开发设计。

(二)日常工作
任务 1：发票号码888505918，物流费用对账导入数据和FMS搜索结果不一致
    排查原因：推凭成功回调了两次，生成两条预估成本，06-10晚开启成本跑批后拉取确认成本。





# WMS费用减免模块 导出Excel首行添加金额合计列
- 提交企业微信审批附件
com.westernpost.wms.util.QyWeiXinApproveUtil#createFile✅

- 物流减免
com.westernpost.wms.web.discounts.LogisticsDiscountsController#exportList✅
com.westernpost.wms.web.discounts.LogisticsDiscountsController#financialExportList✅

- 仓租减免
com.westernpost.wms.web.discounts.StorageRentDiscountsController#exportList✅
com.westernpost.wms.web.discounts.StorageRentDiscountsController#financialExportList✅

- 库内减免
com.westernpost.wms.web.discounts.WarehouseDiscountsController#exportList✅
com.westernpost.wms.web.discounts.WarehouseDiscountsController#financialExportList✅

- 增值减免
com.westernpost.wms.web.discounts.ValueAddedDiscountsController#exportList✅
com.westernpost.wms.web.discounts.ValueAddedDiscountsController#financialExportList✅
com/westernpost/task/service/impl/export/ExportTaskServiceImpl.java:1451✅




// 写入Excel头部,通过上下文拿到Workbook
Workbook workbook = excelWriter.writeContext().writeWorkbookHolder().getCachedWorkbook();
Sheet sheet = workbook.getSheetAt(sheetNo);
Row row = sheet.getRow(0);
if (null == row) {
    row = sheet.createRow(0);
}
Cell cell = row.createCell(headIndex);
row.setHeight((short) 500);
cell.setCellValue(totalDto.getTotalAmount(sheetEnum.getName(), amountHeadList.get(index)));
// 单元格样式
CellStyle cellStyle = workbook.createCellStyle();
cellStyle.setVerticalAlignment(VerticalAlignment.CENTER);
cellStyle.setAlignment(HorizontalAlignment.CENTER);
Font font = workbook.createFont();
font.setFontName("黑体");
font.setFontHeightInPoints((short) 12);
cellStyle.setFont(font);
cell.setCellStyle(cellStyle);