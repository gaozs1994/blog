westernpost-wms:develop/finance-2025.05.29
wpglb-bms-pipeline-task:develop/finance-2025.05.29
westernpost-public:develop/finance-2025.05.29

westernpost-oms:develop/finance-2025.05.29
- oms-出库费用：查询优化9s->2s

wpglb-bms:develop/finance-2025.05.29
- bms-渠道报价设置：查询优化40s->1s

wpglb-fms-task:develop/finance-2025.05.29
- 【FMS-物流成本明细】物流费用同步到FMS物流成本明细是，同个订单fms对应跟踪号为空
- 【FMS-物流成本跑批】只对推凭状态=0,4,7更新推凭参考号、账单数量、总金额

```sql
-- 账单汇总记录表：新增字段is_big_bill
ALTER TABLE westernfulfill.fee_bill_summary
ADD COLUMN is_big_bill TINYINT DEFAULT 0 COMMENT '是否大型账单 0:否 1:是';

ALTER TABLE wpglb_bms.fee_bill_summary
ADD COLUMN is_big_bill TINYINT DEFAULT 0 COMMENT '是否大型账单 0:否 1:是';

-- 渠道报价设计-列表查询：添加联合索引
CREATE INDEX idx_union_usi ON wpglb_bms.logistics_fee_income_config (update_time,sc_code,income_config_id);
CREATE INDEX idx_union_esi ON wpglb_bms.logistics_fee_income_config (end_time,sc_code,income_config_id);
```

（一）财务&渠道需求迭代

任务 1：财务&渠道v2025.05迭代二上线支持。

任务 2：【WMS-账单汇总】账单汇总分批导出优化。

    1. 提交账单汇总任务支持大型账单。
    2. 账单汇总查询新增大型账单筛选条件，返回结果新增大型账单字段。
    3. 大型账单类型走重构后的代码逻辑，先异步线程池分批查询费用数据，写入Excel，并使用Atomic类汇总金额合计并写入Excel首行合计，最后再组装仓库明细、汇总数据并写入Excel。
    4. 账单汇总合并、按客户拆分、按仓库拆分模板流程自测，比较数据量、费用金额汇总等。
任务 3：【BMS-渠道报价设置】列表查询优化。GROUP BY 和 ORDER BY 的列不一致，MySQL 无法同时利用索引进行分组和排序。添加联合索引(update_time,sc_code,income_config_id)，并统一索引列。


（二）技术难题

账单汇总使用EasyExcel导出Excel的，提供的API仅支持从上往下顺序写入，当写入费用数据后，需要对首行写入合计金额，但不支持指定行号写入Excel。研究EasyExcel的write方法源码后，可通过提供的上下文中的缓存WorkBook，通过POI的形式可将金额写入指定单元格，从而解决首行写入问题。



（一）财务&渠道需求迭代

任务 1：财务&渠道v2025.05迭代二上线支持。